---
layout  : wiki
title   : OAuth
summary : 
date    : 2022-09-18 10:07:56 +0900
updated : 2022-09-18 13:32:40 +0900
tag     : 
toc     : true
public  : true
parent  : [[/root-index]]
latex   : false
---
* TOC
{:toc}


## 클라이언트는 왜 리프레시 토큰을 사용하는가?

>
그렇다면 클라이언트는 왜 리프레시 토큰을 사용해야 할까?
OAuth에서는 특정 시점에 액세스 토큰을 더 이상 사용할 수 없게 된다.
사용자가 토큰을 폐기했거나 토큰의 유효 기간이 만료됐거나 다른 시스템이 토큰을 유효하지 않게 만들기도 한다.
클라이언트는 일반적으로 토큰을 사용하는 도중에 자신에게 전달되는 에러 응답을 통해 해당 토큰이 유효하지 않다는 것을 알게 된다.
물론 그런 경우, 클라이언트는 리소스 소유자에게 다신 접근 권한을 요청할 수도 있다.
하지만 그때 리소스 소유자가 마침 없다면 어떻게 해야 할까?
>
OAuth 1.0에서는 그런 경우, 클라이언트는 단지 리소스 소유자에게 의지할 수밖에 없었다.
따라서 그런 상황을 피하기 위해 OAuth 1.0에서는 토큰이 명시적으로 폐기될 때까지 영원히 사용하는 경향이 있었다.
그것은 토큰 탈취를 위한 공격 벡터가 증가함에 따라 문제가 됐다.
즉, 토큰을 탈취한 공격자는 해당 토큰을 영원히 사용할 수 있다는 문제가 있었다.
OAuth 2.0에서는 토큰의 유효 기간이 자동으로 설정되기 때문에 토큰의 유효 기간이 만료되거나 그 때 사용자가 없더라도 리소스에 접근할 수 있는 방법이 필요하다.
그래서 만료 시간 없이 지속적으로 사용하는 토큰 대신 리프레시 토큰이 사용된다.
하지만 리프레시 토큰은 리소스에 접근하기 위한 용도로 사용되는 것이 아니라 리소스에 접근하는 데 사용되는 새로운 액세스 토큰을 요청하는 용도로만 사용된다.
그렇게 함으로써 리프레스 토큰과 액세스 토큰의 유출을 개별적으로 제한할 수 있으며, 상호 보완적으로 만들 수 있다.
>
리프레시 토큰은 또한 클라이언트의 접근 권한을 축소시킬 수도 있다.
만약, 클라이언트가 A, B, C라는 권한 범위를 할당받았는데, A만 있으면 필요한 작업을 수행할 수 있다고 가정하면 리프레시 토큰을 이용해 A 권한 범위만 가진 액세스 토큰을 요청할 수 있다.
이로 인해 스마트한 클라이언트는 최소한의 권한만 가져야 한다는 보안 원칙을 부담 없이 따를 수 있지만, 그렇지 못한 클라이언트는 자신이 호출할 API를 위해 어떤 권한이 필요한지를 파악 해야 한다.
[^richer-74]

요약

- OAuth 1.0 에서는 토큰을 사용할 수 없게 됐을 때마다, 리소스 소유자에게 접근 권한을 다시 요청해야 했다.
    - 이럴 때 리소스 소유자가 부재중이라면 액세스 권한을 얻을 수 없다.
    - 따라서 이 문제를 우회해서 토큰을 만료시키지 않고 아주 오래 사용하는 경향이 생겼다.
    - 이런 경향으로 토큰 탈취와 관련된 심각한 보안 문제가 생겼다.
- OAuth 2.0 에서는 토큰의 유효 기간이 자동으로 설정된다.
    - **유효기간이 만료되었을 때 리소스 소유자가 부재중인 경우**의 대안으로 리프레시 토큰을 사용한다.
    - 리프레시 토큰이 있기 때문에 각 엑세스 토큰의 만료 시간을 아주 길게 잡지 않아도 되는 것.
- 리프레시 토큰을 써서 새로 얻는 엑세스 토큰이 축소된 권한을 갖게 하는 것도 가능하다.
    - 예) SNS 서비스 클라이언트
        - old 엑세스 토큰의 접근 권한
            - 친구 목록 보기, 사용자 프로필 수정, 사용자 대신 글 올리기
        - 리프레시 토큰으로 얻은 new 엑세스 토큰의 접근 권한
            - 친구 목록 보기

## 참고문헌

- OAuth 2 in Action / 저스틴 리처, 안토니오 산소 저/윤우빈 역 / 에이콘출판사 / 발행 2018년 04월 17일 / 원제 : OAuth 2 in Action

## 주석

[^richer-74]: OAuth 2 in Action. 2장. 74쪽.

